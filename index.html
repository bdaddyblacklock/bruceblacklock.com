<html>
<link href='navstyle.css' rel='stylesheet'>
<link href='progressLog.css' rel='stylesheet'>
<!-- <script type="text/javascript" src="horizontalAdjustment.js"></script> -->
<link href='pageTemplate.css' rel='stylesheet'>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="icon" type="image/png" href="http://bruceblacklock.com/MadMinute.png">

<style type="text/css">
    #topNavBuffer2 {
        height: 77px;
    }

    .base-timer {
        position: relative;
        width: 100px;
        height: 100px;
    }

    .base-timer__svg {
        transform: scaleX(-1);
    }

    .base-timer__circle {
        fill: none;
        stroke: none;
    }

    .base-timer__path-elapsed {
        stroke-width: 7px;
        stroke: grey;
    }

    .base-timer__path-remaining {
        stroke-width: 7px;
        stroke-linecap: round;
        transform: rotate(90deg);
        transform-origin: center;
        transition: 1s linear all;
        fill-rule: nonzero;
        stroke: currentColor;
    }

    .base-timer__path-remaining.green {
        color: rgb(65, 184, 131);
    }

    .base-timer__path-remaining.orange {
        color: orange;
    }

    .base-timer__path-remaining.red {
        color: red;
    }

    .base-timer__label {
        position: absolute;
        width: 100px;
        height: 100px;
        top: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
    }

    .selectButton {
        display: block;
        font-size: 1.5em;
        margin-block-start: 0.83em;
        margin-inline-start: 0px;
        margin-inline-end: 0px;
        font-weight: bold;
        padding-top: 25px;
        padding-bottom: 25px;
        min-width: 135px;
        position: relative;
        background-color: grey;
        width: 40%;
        display: inline-block;
        bottom: 10%;
        text-align: center;
        border-radius: 8px;
        cursor: pointer;
        border: none;
    }

    .selectButton:hover {
        background-color: purple;
        color: white;
    }

    .reportCell {
        text-align: center;
    }


    #report th {
        border-bottom: 3px solid white;
        width: 130px;
    }
</style>

<head>
    <link rel="icon" type="image/png" href="flaviconprime3.png" />

    <title>
        Mad Minutes
    </title>

    <!-- google-->
    <meta name="google-signin-client_id"
        content="423403640724-4qg2iimt8unje7cafcmnnh0b8ka656dd.apps.googleusercontent.com">
    </meta>


</head>

<body>
    <div id="AllButFooter">


        <div id="topNavBuffer2"></div>
        <div id="notNav">
            <div id="chemistrymap" style="display: block;">
                <div id="testOptions">
                    <button class="selectButton" type="button" id="Zeroes" onclick="setPage(0,0)"
                        style="width: 150px">0</button>
                    <button class="selectButton" type="button" id="Ones" onclick="setPage(0,1)"
                        style="width: 150px">1</button>
                    <button class="selectButton" type="button" id="Twos" onclick="setPage(0,2)"
                        style="width: 150px">2</button>
                    <button class="selectButton" type="button" id="Threes" onclick="setPage(0,3)"
                        style="width: 150px">3</button>
                    <button class="selectButton" type="button" id="Fours" onclick="setPage(0,4)"
                        style="width: 150px">4</button>
                    <button class="selectButton" type="button" id="Fives" onclick="setPage(0,5)"
                        style="width: 150px">5</button>
                    <button class="selectButton" type="button" id="Sixs" onclick="setPage(0,6)"
                        style="width: 150px">6</button>
                    <button class="selectButton" type="button" id="Sevens" onclick="setPage(0,7)"
                        style="width: 150px">7</button>
                    <button class="selectButton" type="button" id="Eights" onclick="setPage(0,8)"
                        style="width: 150px">8</button>
                    <button class="selectButton" type="button" id="Nines" onclick="setPage(0,9)"
                        style="width: 150px">9</button>
                    <button class="selectButton" type="button" id="Tens" onclick="setPage(0,10)"
                        style="width: 150px">10</button>
                    <button class="selectButton" type="button" id="Elevens" onclick="setPage(0,11)"
                        style="width: 150px">11</button>
                    <button class="selectButton" type="button" id="Twelves" onclick="setPage(0,12)"
                        style="width: 150px">12</button><br><br>
                    <button class="selectButton" type="button" onclick="setPage(1,1)" style="width: 150px">1</button>
                    <button class="selectButton" type="button" onclick="setPage(1,2)" style="width: 150px">2</button>
                    <button class="selectButton" type="button" onclick="setPage(1,3)" style="width: 150px">3</button>
                    <button class="selectButton" type="button" onclick="setPage(1,4)" style="width: 150px">4</button>
                    <button class="selectButton" type="button" onclick="setPage(1,5)" style="width: 150px">5</button>
                    <button class="selectButton" type="button" onclick="setPage(1,6)" style="width: 150px">6</button>
                    <button class="selectButton" type="button" onclick="setPage(1,7)" style="width: 150px">7</button>
                    <button class="selectButton" type="button" onclick="setPage(1,8)" style="width: 150px">8</button>
                    <button class="selectButton" type="button" onclick="setPage(1,9)" style="width: 150px">9</button>
                    <button class="selectButton" type="button" onclick="setPage(1,10)" style="width: 150px">10</button>
                    <button class="selectButton" type="button" onclick="setPage(1,11)" style="width: 150px">11</button>
                    <button class="selectButton" type="button" onclick="setPage(1,12)" style="width: 150px">12</button>
                </div>
                <div id="testDiv" style="display:none;">
                    <div id="app"></div>
                    <div id="QnA">
                    </div>
                    <input type="text" id="answer"><br>
                    <div id="feedback"></div>
                </div>
                <div id="result" style="display:none;"></div>
                <div id="tableDIV">
                </div>
                <button class="selectButton" type="button" id="After" style="width: 150px; display: none;"
                    onclick="proceed()"></button>
            </div>
        </div>
    </div>


    <div id="bottomBuffer"></div>
    <div id="footer" style="display:block">
    </div>
</body>


<script>
    var numberInQuestion;
    var answer;
    var question;
    var questions = [];
    var passed;
    var quiz;

    function proceed() {
        if (passed == true) {
            passed = false;
            numberInQuestion++;
        }
        setPage(quiz, numberInQuestion)
    }

    function setPage(quizType, quizNumber) {
        document.getElementById("After").style.display = "none";
        document.getElementById("feedback").innerHTML = "";
        document.getElementById("result").style.display = "none";
        console.log("The page is being set! We're on number: " + numberInQuestion);
        numberOfQuestions = 0;
        numberCorrect = 0;
        questions = [];
        timeLeft = 120;
        timePassed = 0;

        document.getElementById("testOptions").style.display = "none"; //divsToHide is an array

        quiz = quizType;
        numberInQuestion = quizNumber;

        document.getElementById("tableDIV").innerHTML = `
        <table id="report" style="display:none">
            <tr>
                <th>Question</th>
                <th>Your Answered</th>
                <th>Points</th>
            </tr>
        </table>`

        nextQuestion();
        document.getElementById("testDiv").style.display = "block";
        document.getElementById("base-timer").style.display = "block";
        startTimer();
    }

    function nextQuestion() {
        numberOfQuestions++;
        generateNextQuestion();
        document.getElementById("QnA").innerHTML = question;
        document.getElementById('answer').value = '';
    }

    function generateNextQuestion() {

        while (true) {
            var nextNumber = Math.floor(Math.random() * 10);
            var questionType = Math.floor((Math.random() * 2) + 1);

            answer = numberInQuestion * nextNumber;

            if (quiz == 0) {
                if (questionType == 1) {
                    question = nextNumber + " x " + numberInQuestion;
                }
                else {
                    question = numberInQuestion + " x " + nextNumber;
                }
                if (!questions.includes(question)) {
                    questions.push(question);
                    return;
                }
            }
            else {
                question = answer + " / " + numberInQuestion;
                answer = nextNumber;
                if (!questions.includes(question)) {
                    questions.push(question);
                    return;
                }
            }


            // console.log("You already did " + question + " eh?")
        }

    }


    function checkQuestion() {
        var studentAnswer = document.getElementById("answer").value;
        if (studentAnswer == "") { return; }
        var table = document.getElementById("report");
        var row = table.insertRow(numberOfQuestions)
        var cell1 = row.insertCell(0);
        var cell3 = row.insertCell(1);
        var cell4 = row.insertCell(2);
        cell1.innerHTML = question + " = " + answer;
        cell3.innerHTML = studentAnswer;
        cell1.className = "reportCell"
        cell3.className = "reportCell"
        cell4.className = "reportCell"

        if (studentAnswer == answer) {
            document.getElementById("feedback").innerHTML = "CORRECT!"
            numberCorrect++;
            cell4.innerHTML = "✓";
            cell4.style.color = "green";
        }
        else {
            document.getElementById("feedback").innerHTML = "WRONG!"
            cell4.innerHTML = "X";
            cell4.style.color = "red";
        }
        if ((numberOfQuestions == 15 && quiz == 0) || (numberOfQuestions == 10 && quiz == 1)) {
            validate()
        }
        else {
            nextQuestion()
        }
    }

    function validate() {
        clearInterval(timerInterval);

        var minutes = Math.floor(timePassed / 60);
        var seconds = timePassed - minutes * 60;
        var finalTime;
        if (minutes > 0) {
            if (minutes > 1) {
                finalTime = minutes + " minutes";
            }
            else {
                finalTime = minutes + " minute";
            }
            if (seconds > 0) {
                finalTime.concat(" and " + seconds + " seconds");
            }
        }
        else {
            finalTime = seconds + " seconds"
        }
        var nexter = numberInQuestion + 1;
        if ((numberCorrect >= 14 && quiz == 0) || (numberCorrect >= 9 && quiz == 1)) {
            document.getElementById("result").innerHTML = "YOU PASSED WITH " + numberCorrect + "/"+ numberOfQuestions +" (" + (Math.round(numberCorrect / numberOfQuestions * 100)) + "%) <br> Time: " + finalTime + "<br> Next time try your " + (nexter) + "s";
            document.getElementById("result").style.display = "block";

            document.getElementById("After").innerHTML = "NEXT";

            passed = true;
            // document.getElementById("After").addEventListener("click", function () {
            //     document.getElementById("report").remove();
            //     setPage(numberInQuestion);
            // });
        }
        else {
            document.getElementById("result").innerHTML = "YOU FAILED: " + numberCorrect + "/" + numberOfQuestions + " (" + (Math.round(numberCorrect / numberOfQuestions * 100)) + "%) <br> Time: " + finalTime;
            document.getElementById("result").style.display = "block";
            document.getElementById("After").innerHTML = "RETRY";
            passed = false
            // document.getElementById("After").addEventListener("click", function () {
            //     document.getElementById("report").remove();
            //     setPage(1000);
            // });
        }
        document.getElementById("report").style.display = "block";
        document.getElementById("testDiv").style.display = "none";
        if (numberInQuestion != 12) {
            document.getElementById("After").style.display = "block";
        }
        document.getElementById("base-timer").style.display = "none";
    }

    document.getElementById("answer").addEventListener("keydown", function (e) {
        if (e.keyCode === 13) {  //checks whether the pressed key is "Enter"
            checkQuestion()
        }
    });



    // Credit: Mateusz Rybczonec

    var FULL_DASH_ARRAY = 283;
    var WARNING_THRESHOLD = 30;
    var ALERT_THRESHOLD = 10;

    const COLOR_CODES = {
        info: {
            color: "green"
        },
        warning: {
            color: "orange",
            threshold: WARNING_THRESHOLD
        },
        alert: {
            color: "red",
            threshold: ALERT_THRESHOLD
        }
    };

    var TIME_LIMIT = 120;
    var timePassed = 0;
    var timeLeft = TIME_LIMIT;
    var timerInterval = null;
    var remainingPathColor = COLOR_CODES.info.color;

    generateTimer()

    function generateTimer() {
        document.getElementById("app").innerHTML = `
<div class="base-timer" id="base-timer">
  <svg class="base-timer__svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
    <g class="base-timer__circle">
      <circle class="base-timer__path-elapsed" cx="50" cy="50" r="45"></circle>
      <path
        id="base-timer-path-remaining"
        stroke-dasharray="283"
        class="base-timer__path-remaining ${remainingPathColor}"
        d="
          M 50, 50
          m -45, 0
          a 45,45 0 1,0 90,0
          a 45,45 0 1,0 -90,0
        "
      ></path>
    </g>
  </svg>
  <span id="base-timer-label" class="base-timer__label">${formatTime(
            timeLeft
        )}</span>
</div>
`;
    }


    function onTimesUp() {
        clearInterval(timerInterval);
        validate()
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            timePassed = timePassed += 1;
            timeLeft = TIME_LIMIT - timePassed;
            document.getElementById("base-timer-label").innerHTML = formatTime(
                timeLeft
            );
            setCircleDasharray();
            setRemainingPathColor(timeLeft);

            if (timeLeft === 0) {
                onTimesUp();
            }
        }, 1000);
    }

    function formatTime(time) {
        const minutes = Math.floor(time / 60);
        let seconds = time % 60;

        if (seconds < 10) {
            seconds = `0${seconds}`;
        }

        return `${minutes}:${seconds}`;
    }

    function setRemainingPathColor(timeLeft) {
        const { alert, warning, info } = COLOR_CODES;
        if (timeLeft <= alert.threshold) {
            document
                .getElementById("base-timer-path-remaining")
                .classList.remove(warning.color);
            document
                .getElementById("base-timer-path-remaining")
                .classList.add(alert.color);
        } else if (timeLeft <= warning.threshold) {
            document
                .getElementById("base-timer-path-remaining")
                .classList.remove(info.color);
            document
                .getElementById("base-timer-path-remaining")
                .classList.add(warning.color);
        }
    }

    function calculateTimeFraction() {
        const rawTimeFraction = timeLeft / TIME_LIMIT;
        return rawTimeFraction - (1 / TIME_LIMIT) * (1 - rawTimeFraction);
    }

    function setCircleDasharray() {
        const circleDasharray = `${(
            calculateTimeFraction() * FULL_DASH_ARRAY
        ).toFixed(0)} 283`;
        document
            .getElementById("base-timer-path-remaining")
            .setAttribute("stroke-dasharray", circleDasharray);
    }
</script>

</html>